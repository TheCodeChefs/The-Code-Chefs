(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();const L=document.querySelector(".hamburger-button"),w=document.querySelector(".mobile-menu"),x=document.querySelector(".nav-menu"),V=document.querySelector(".close-button"),H=document.querySelector(".toggle-label"),p=document.querySelector(".toggle"),P=()=>{const t=localStorage.getItem("theme")?localStorage.getItem("theme"):null;t&&(document.body.setAttribute("data-theme",t),t==="dark"?p.checked=!0:p.checked=!1)};P();L.addEventListener("click",()=>{w.classList.add("show"),L.classList.add(".show"),x.classList.add("nav-show"),H.classList.add("toggle-label-show"),p.classList.add("toggle-label-show")});V.addEventListener("click",()=>{w.classList.remove("show"),L.classList.remove(".show"),x.classList.remove("nav-show"),H.classList.remove("toggle-label-show"),p.classList.remove("toggle-label-show")});p.addEventListener("change",()=>{p.checked?(document.body.setAttribute("data-theme","dark"),w.classList.add("mobile-menu-color"),localStorage.setItem("theme","dark")):(document.body.setAttribute("data-theme","light"),w.classList.remove("mobile-menu-color"),localStorage.setItem("theme","light"))});const T="https://tasty-treats-backend.p.goit.global/api",s=(t,e=document)=>e.querySelector(t),y=(t,e=document)=>[...e.querySelectorAll(t)],O=t=>t&&t.classList.remove("hidden"),b=t=>t&&t.classList.add("hidden");function $(t){const e=Number.parseFloat(String(t??"").replace(",","."));return Number.isFinite(e)?(Math.trunc(e*100)/100).toFixed(2):"0.00"}function q(t,e){if(!t)return;if(!e){t.style.backgroundImage="";return}const n=String(e).trim().replace(/"/g,"%22").replace(/\)/g,"%29").replace(/\(/g,"%28").replace(/\\+/g,"");t.style.backgroundImage=`url("${n}")`}const U="./img/icons.svg",_=(t,e="")=>`<svg class="icon ${e}" aria-hidden="true" focusable="false">
     <use href="${U}#icon-${t}"></use>
   </svg>`,j=`<span class="star filled">${_("Star")}</span>`,D=`<span class="star empty">${_("Star-empty")}</span>`;function A(t){if(!t)return;const e=document.documentElement;let n=getComputedStyle(e).getPropertyValue("--star-empty").trim();n||(n=e.getAttribute("data-theme")==="dark"?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.2)"),y(".star.empty .icon",t).forEach(i=>{i.style.fill=n}),y(".star.empty use",t).forEach(i=>{i.setAttribute("fill",n)}),y(".star.empty .icon path",t).forEach(i=>{i.setAttribute("fill",n),i.setAttribute("stroke","none")})}function R(t,e){if(!t)return;const n=Number(e)||0,i=Math.min(5,Math.max(0,Math.floor(n)));t.classList.add("star-row"),t.innerHTML=`${j.repeat(i)}${D.repeat(5-i)}`,A(t)}function F(){try{const t=JSON.parse(localStorage.getItem("favorites"));return Array.isArray(t)?t:[]}catch{return[]}}function J(t){localStorage.setItem("favorites",JSON.stringify(t||[]))}const E=t=>(t==null?void 0:t._id)||(t==null?void 0:t.id)||(t==null?void 0:t.recipeId)||"",B=(t,e)=>(t||[]).findIndex(n=>String(E(n))===String(e));function z(t){var n;const e=E(t);return{...t,_id:e,title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",rating:Number(t==null?void 0:t.rating)||0,preview:(t==null?void 0:t.preview)||(t==null?void 0:t.thumb)||(t==null?void 0:t.image_url)||(t==null?void 0:t.imageUrl)||"",category:typeof(t==null?void 0:t.category)=="string"?{name:t.category}:(n=t==null?void 0:t.category)!=null&&n.name?t.category:(t==null?void 0:t.category)||{}}}function M(t){return B(F(),t)!==-1}function G(t,e){const n=new CustomEvent("favorites:sync",{detail:{id:String(t),on:!!e}});window.dispatchEvent(n),document.dispatchEvent(n)}function K(){const t=new Event("favorites:updated");window.dispatchEvent(t),document.dispatchEvent(t)}function Z(t,e){const n=F(),i=B(n,t);let a=!1;return i!==-1?(n.splice(i,1),a=!1):(n.unshift(z(e||{_id:t})),a=!0),J(n),G(t,a),K(),a}let f=null,I=0,h=!1;window.__currentRecipeId="";function d(){return{overlay:s("#popup-overlay"),content:s("#popup-content"),pmImage:s("#pm-image"),pmVideo:s("#pm-video"),pmIframe:s("#pm-iframe"),pmTitle:s("#pm-title"),pmRatingVal:s("#pm-rating-val"),pmStars:s("#pm-stars"),pmTime:s("#pm-time"),pmIngredients:s("#pm-ingredients"),pmTags:s("#pm-tags"),pmDesc:s("#pm-desc"),favBtn:s("#pm-fav-btn"),rateBtn:s("#pm-rate-btn"),ratingOverlay:s("#rating-overlay"),ratingStars:s("#rating-stars"),ratingValueEl:s("#rating-value"),ratingEmail:s("#rating-email"),ratingSend:s("#rating-send"),ratingHint:s("#rating-hint")}}function C(t){var a,r,l,u,v;const e=d();if(!e.content)return;const n=String(E(t));n&&(e.content.dataset.recipeId=n,e.ratingOverlay&&(e.ratingOverlay.dataset.recipeId=n),window.__currentRecipeId=n),e.pmTitle&&(e.pmTitle.textContent=t.title||"Untitled"),e.pmRatingVal&&(e.pmRatingVal.textContent=$(t.rating)),R(e.pmStars,t.rating||0),e.pmTime&&(e.pmTime.textContent=t.time?`${t.time} min`:"");const i=t.youtube||t.youtubeUrl||"";if(i){(a=e.pmVideo)==null||a.classList.remove("hidden"),(r=e.pmImage)==null||r.classList.add("hidden");const o=((l=i.match(/(?:v=|\/)([0-9A-Za-z_-]{11})(?:\b|&|$)/))==null?void 0:l[1])||i;e.pmIframe&&(e.pmIframe.src=`https://www.youtube.com/embed/${o}?rel=0&modestbranding=1&playsinline=1`)}else{(u=e.pmVideo)==null||u.classList.add("hidden"),(v=e.pmImage)==null||v.classList.remove("hidden");const o=t.image_url||t.imageUrl||t.preview||t.thumb||"";q(e.pmImage,o)}e.pmIngredients&&(e.pmIngredients.innerHTML="",(t.ingredients||[]).forEach(o=>{const g=typeof o=="string"?o:(o==null?void 0:o.name)||"",c=typeof o=="string"?"":(o==null?void 0:o.measure)||"",m=document.createElement("div");m.className="ing-row",m.innerHTML=`<span class="ing-name">${g}</span><span class="ing-measure">${c}</span>`,e.pmIngredients.appendChild(m)})),e.pmTags&&(e.pmTags.innerHTML="",(t.tags||[]).forEach(o=>{const g=document.createElement("span");g.className="tag-chip",g.textContent=`#${o}`,e.pmTags.appendChild(g)})),e.pmDesc&&(e.pmDesc.textContent=t.description||""),e.favBtn&&n&&(e.favBtn.textContent=M(n)?"Remove to favorite":"Add to favorite")}function k(){var n,i;const t=d(),e=((i=(n=t.content)==null?void 0:n.dataset)==null?void 0:i.recipeId)||window.__currentRecipeId||"";!t.favBtn||!e||(t.favBtn.textContent=M(e)?"Remove to favorite":"Add to favorite")}window.openPopup=async function(e){const n=d();if(!n.overlay)return;document.documentElement.style.overflow="hidden",f=typeof e=="object"&&e?e:{_id:String(e||"")},C(f),O(n.overlay),k();const i=E(f);if(i)try{const a=await fetch(`${T}/recipes/${encodeURIComponent(i)}`);if(a.ok){const r=await a.json();f={...f,...r},C(f),k()}}catch{}};document.addEventListener("click",t=>{const e=d();(t.target.closest(".popup-x")||e.overlay&&t.target===e.overlay)&&(b(e.overlay),document.documentElement.style.overflow="",e.pmIframe&&(e.pmIframe.src=""))});window.addEventListener("keydown",t=>{if(t.key!=="Escape")return;const e=d();if(e.ratingOverlay&&!e.ratingOverlay.classList.contains("hidden")){b(e.ratingOverlay);return}b(e.overlay),document.documentElement.style.overflow="",e.pmIframe&&(e.pmIframe.src="")});document.addEventListener("click",t=>{var a,r;const e=d();if(!t.target.closest("#pm-fav-btn"))return;const n=((r=(a=e.content)==null?void 0:a.dataset)==null?void 0:r.recipeId)||window.__currentRecipeId||"";if(!n)return;const i=Z(n,f);e.favBtn&&(e.favBtn.textContent=i?"Remove to favorite":"Add to favorite")});function N(t){t&&y("svg path",t).forEach(e=>e.setAttribute("fill","#dcdcdc"))}function Q(t,e){if(!t)return;N(t);const n=Math.floor(e),i=e%1>=.5;y(".star-container",t).forEach((a,r)=>{const l=r+1,u=s("path",a);u&&(l<=n?u.setAttribute("fill","#eea10b"):l===n+1&&i&&u.setAttribute("fill",`url(#halfGradient-${l})`))})}function S(t){var a;const e=((a=t.ratingEmail)==null?void 0:a.value.trim())||"",n=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),i=I>0&&n&&!h;t.ratingSend&&(t.ratingSend.disabled=!i),t.ratingHint&&(t.ratingHint.textContent=i?"":"Enter valid email and select rating.")}const W=new MutationObserver(()=>{const t=d();t!=null&&t.pmStars&&A(t.pmStars)});W.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]});document.addEventListener("click",t=>{var n,i;const e=d();if(t.target.closest("#pm-rate-btn")){const a=((i=(n=e.content)==null?void 0:n.dataset)==null?void 0:i.recipeId)||window.__currentRecipeId||"";a&&e.ratingOverlay&&(e.ratingOverlay.dataset.recipeId=String(a)),I=0,h=!1,e.ratingValueEl&&(e.ratingValueEl.textContent="0.00"),e.ratingEmail&&(e.ratingEmail.value=""),e.ratingHint&&(e.ratingHint.textContent=""),e.ratingSend&&(e.ratingSend.disabled=!0),N(e.ratingStars),O(e.ratingOverlay);return}(t.target.closest("#rating-close")||e.ratingOverlay&&t.target===e.ratingOverlay)&&b(e.ratingOverlay)});document.addEventListener("input",t=>{const e=d();t.target===e.ratingEmail&&S(e)});document.addEventListener("click",t=>{var a;const e=d(),n=t.target.closest(".half-btn");if(!n||!((a=e.ratingStars)!=null&&a.contains(n)))return;const i=parseFloat(n.dataset.val||n.dataset.value);i&&(I=i,e.ratingValueEl&&(e.ratingValueEl.textContent=i.toFixed(2)),Q(e.ratingStars,i),S(e))});document.addEventListener("click",async t=>{var a,r,l,u,v;const e=d();if(!t.target.closest("#rating-send")||h)return;const n=((r=(a=e.ratingOverlay)==null?void 0:a.dataset)==null?void 0:r.recipeId)||((u=(l=e.content)==null?void 0:l.dataset)==null?void 0:u.recipeId)||window.__currentRecipeId||"";if(!n){e.ratingHint&&(e.ratingHint.textContent="Technical error: recipe id missing.",e.ratingHint.classList.remove("ok"));return}const i={rate:Number(I),email:(((v=e.ratingEmail)==null?void 0:v.value)||"").trim()};try{h=!0,S(e),e.ratingHint&&(e.ratingHint.textContent="");const o=`${T}/recipes/${encodeURIComponent(n)}/rating`,g=await fetch(o,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!g.ok){let c="Failed to send rating";try{const m=await g.json();m!=null&&m.message&&(c=m.message)}catch{}throw new Error(`${c} (HTTP ${g.status})`)}e.ratingHint&&(e.ratingHint.textContent="Thanks for rating!",e.ratingHint.classList.add("ok"));try{const c=await fetch(`${T}/recipes/${encodeURIComponent(n)}`).then(m=>m.json());e.pmRatingVal&&(e.pmRatingVal.textContent=$(c==null?void 0:c.rating)),R(e.pmStars,(c==null?void 0:c.rating)??0)}catch{}setTimeout(()=>b(e.ratingOverlay),900)}catch(o){e.ratingHint&&(e.ratingHint.textContent=(o==null?void 0:o.message)||"Error sending rating.",e.ratingHint.classList.remove("ok"))}finally{h=!1,S(e)}});
//# sourceMappingURL=popup_menu-DF61AjEs.js.map
