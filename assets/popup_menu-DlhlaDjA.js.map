{"version":3,"file":"popup_menu-DlhlaDjA.js","sources":["../../src/js/header.js","../../src/js/popup_menu.js"],"sourcesContent":["const hamburgerButton = document.querySelector('.hamburger-button');\nconst mobileMenu = document.querySelector('.mobile-menu');\nconst navMenu = document.querySelector('.nav-menu');\nconst closeButton = document.querySelector('.close-button');\nconst toggleLabel = document.querySelector('.toggle-label');\nconst toggleInput = document.querySelector('.toggle');\n\nconst checkTheme = () => {\n  const currentTheme = localStorage.getItem('theme')\n    ? localStorage.getItem('theme')\n    : null;\n  if (currentTheme) {\n    document.body.setAttribute('data-theme', currentTheme);\n    if (currentTheme === 'dark') {\n      toggleInput.checked = true;\n    } else {\n      toggleInput.checked = false;\n    }\n  }\n};\ncheckTheme();\n\nhamburgerButton.addEventListener('click', () => {\n  mobileMenu.classList.add('show');\n  hamburgerButton.classList.add('.show');\n  navMenu.classList.add('nav-show');\n  toggleLabel.classList.add('toggle-label-show');\n  toggleInput.classList.add('toggle-label-show');\n});\ncloseButton.addEventListener('click', () => {\n  mobileMenu.classList.remove('show');\n  hamburgerButton.classList.remove('.show');\n  navMenu.classList.remove('nav-show');\n  toggleLabel.classList.remove('toggle-label-show');\n  toggleInput.classList.remove('toggle-label-show');\n});\ntoggleInput.addEventListener('change', () => {\n  if (toggleInput.checked) {\n    document.body.setAttribute('data-theme', 'dark');\n    mobileMenu.classList.add('mobile-menu-color');\n    localStorage.setItem('theme', 'dark');\n  } else {\n    document.body.setAttribute('data-theme', 'light');\n    mobileMenu.classList.remove('mobile-menu-color');\n    localStorage.setItem('theme', 'light');\n  }\n});\n","// js/popup_menu.js — popup + favorites\nconst API_ROOT = 'https://tasty-treats-backend.p.goit.global/api';\n\n/* = Helpers = */\nconst qs = (s, p = document) => p.querySelector(s);\nconst qsa = (s, p = document) => [...p.querySelectorAll(s)];\nconst show = el => el && el.classList.remove('hidden');\nconst hide = el => el && el.classList.add('hidden');\nconst esc = s =>\n  (s ?? '').toString().replace(\n    /[&<>\"']/g,\n    m =>\n      ({\n        '&': '&amp;',\n        '<': '&lt;',\n        '>': '&gt;',\n        '\"': '&quot;',\n        \"'\": '&#39;',\n      }[m])\n  );\n\n// 2 ondalık TRUNC\nfunction format2Trunc(v) {\n  const n = Number.parseFloat(String(v ?? '').replace(',', '.'));\n  if (!Number.isFinite(n)) return '0.00';\n  const t = Math.trunc(n * 100) / 100;\n  return t.toFixed(2);\n}\n\n// Güvenli background-image setter\nfunction setBgImage(el, url) {\n  if (!el) return;\n  if (!url) {\n    el.style.backgroundImage = '';\n    return;\n  }\n  const safe = String(url)\n    .trim()\n    .replace(/\"/g, '%22')\n    .replace(/\\)/g, '%29')\n    .replace(/\\(/g, '%28')\n    .replace(/\\\\+/g, '');\n  el.style.backgroundImage = `url(\"${safe}\")`;\n}\n\n/* = Sprite (popup yıldızları için) = */\nconst SPRITE_PATH = './img/icons.svg';\nconst svgIcon = (name, className = '') =>\n  `<svg class=\"icon ${className}\" aria-hidden=\"true\" focusable=\"false\">\n     <use href=\"${SPRITE_PATH}#icon-${name}\"></use>\n   </svg>`;\n\n/* = Basit yıldız = */\nconst starFilledHTML = `<span class=\"star filled\">${svgIcon('Star')}</span>`;\nconst starEmptyHTML = `<span class=\"star empty\">${svgIcon(\n  'Star-empty'\n)}</span>`;\n\n/* Boş yıldızların rengini tema değişkeninden oku ve uygula */\nfunction enforceEmptyStarColor(root) {\n  if (!root) return;\n\n  // Tema değişkenini al (yoksa light/dark fallback)\n  const docEl = document.documentElement;\n  let color = getComputedStyle(docEl).getPropertyValue('--star-empty').trim();\n  if (!color) {\n    color =\n      docEl.getAttribute('data-theme') === 'dark'\n        ? 'rgba(255,255,255,0.2)'\n        : 'rgba(0,0,0,0.2)';\n  }\n\n  // <svg> ve <use>\n  qsa('.star.empty .icon', root).forEach(svg => {\n    svg.style.fill = color;\n  });\n  qsa('.star.empty use', root).forEach(u => {\n    u.setAttribute('fill', color);\n  });\n\n  // Inline path (external sprite’ta olmayabilir, sorun değil)\n  qsa('.star.empty .icon path', root).forEach(p => {\n    p.setAttribute('fill', color);\n    p.setAttribute('stroke', 'none');\n  });\n}\n\nfunction renderStaticStars(container, val) {\n  if (!container) return;\n  const n = Number(val) || 0;\n  const full = Math.min(5, Math.max(0, Math.floor(n)));\n  container.classList.add('star-row');\n  container.innerHTML = `${starFilledHTML.repeat(full)}${starEmptyHTML.repeat(\n    5 - full\n  )}`;\n  enforceEmptyStarColor(container);\n}\n\n/* = Favorites (LS) = */\nfunction getFavorites() {\n  try {\n    const v = JSON.parse(localStorage.getItem('favorites'));\n    return Array.isArray(v) ? v : [];\n  } catch {\n    return [];\n  }\n}\nfunction setFavorites(arr) {\n  localStorage.setItem('favorites', JSON.stringify(arr || []));\n}\nconst getIdSafe = o => o?._id || o?.id || o?.recipeId || '';\nconst findIndexById = (list, id) =>\n  (list || []).findIndex(r => String(getIdSafe(r)) === String(id));\nfunction makeFavoritePayload(src) {\n  const id = getIdSafe(src);\n  return {\n    ...src,\n    _id: id,\n    title: src?.title || '',\n    description: src?.description || '',\n    rating: Number(src?.rating) || 0,\n    preview:\n      src?.preview || src?.thumb || src?.image_url || src?.imageUrl || '',\n    category:\n      typeof src?.category === 'string'\n        ? { name: src.category }\n        : src?.category?.name\n        ? src.category\n        : src?.category || {},\n  };\n}\nfunction isFavorite(id) {\n  return findIndexById(getFavorites(), id) !== -1;\n}\n\n/* = Yayıncılar = */\nfunction emitFavoritesSync(id, on) {\n  const ev = new CustomEvent('favorites:sync', {\n    detail: { id: String(id), on: !!on },\n  });\n  window.dispatchEvent(ev);\n  document.dispatchEvent(ev);\n}\nfunction emitFavoritesUpdated() {\n  const ev = new Event('favorites:updated');\n  window.dispatchEvent(ev);\n  document.dispatchEvent(ev);\n}\n\n/* = Toggle = */\nfunction toggleFavoriteById(id, recipeObjForAdd) {\n  const list = getFavorites();\n  const idx = findIndexById(list, id);\n  let nowOn = false;\n\n  if (idx !== -1) {\n    list.splice(idx, 1);\n    nowOn = false;\n  } else {\n    list.unshift(makeFavoritePayload(recipeObjForAdd || { _id: id }));\n    nowOn = true;\n  }\n  setFavorites(list);\n  emitFavoritesSync(id, nowOn);\n  emitFavoritesUpdated();\n\n  return nowOn;\n}\n\n/* = Popup state/refs = */\nlet currentRecipe = null;\nlet currentRating = 0;\nlet ratingSubmitting = false;\nwindow.__currentRecipeId = '';\n\nfunction refs() {\n  return {\n    overlay: qs('#popup-overlay'),\n    content: qs('#popup-content'),\n    pmImage: qs('#pm-image'),\n    pmVideo: qs('#pm-video'),\n    pmIframe: qs('#pm-iframe'),\n    pmTitle: qs('#pm-title'),\n    pmRatingVal: qs('#pm-rating-val'),\n    pmStars: qs('#pm-stars'),\n    pmTime: qs('#pm-time'),\n    pmIngredients: qs('#pm-ingredients'),\n    pmTags: qs('#pm-tags'),\n    pmDesc: qs('#pm-desc'),\n    favBtn: qs('#pm-fav-btn'),\n\n    // ⭐ rating overlay elemanları\n    rateBtn: qs('#pm-rate-btn'),\n    ratingOverlay: qs('#rating-overlay'),\n    ratingStars: qs('#rating-stars'),\n    ratingValueEl: qs('#rating-value'),\n    ratingEmail: qs('#rating-email'),\n    ratingSend: qs('#rating-send'),\n    ratingHint: qs('#rating-hint'),\n  };\n}\n\n/* = Render = */\nfunction renderDetails(recipe) {\n  const r = refs();\n  if (!r.content) return;\n  const id = String(getIdSafe(recipe));\n  if (id) {\n    r.content.dataset.recipeId = id;\n    r.ratingOverlay && (r.ratingOverlay.dataset.recipeId = id);\n    window.__currentRecipeId = id;\n  }\n  r.pmTitle && (r.pmTitle.textContent = recipe.title || 'Untitled');\n  r.pmRatingVal && (r.pmRatingVal.textContent = format2Trunc(recipe.rating));\n  renderStaticStars(r.pmStars, recipe.rating || 0);\n  r.pmTime && (r.pmTime.textContent = recipe.time ? `${recipe.time} min` : '');\n\n  const yt = recipe.youtube || recipe.youtubeUrl || '';\n  if (yt) {\n    r.pmVideo?.classList.remove('hidden');\n    r.pmImage?.classList.add('hidden');\n    const vid = yt.match(/(?:v=|\\/)([0-9A-Za-z_-]{11})(?:\\b|&|$)/)?.[1] || yt;\n    if (r.pmIframe)\n      r.pmIframe.src = `https://www.youtube.com/embed/${vid}?rel=0&modestbranding=1&playsinline=1`;\n  } else {\n    r.pmVideo?.classList.add('hidden');\n    r.pmImage?.classList.remove('hidden');\n    const img =\n      recipe.image_url ||\n      recipe.imageUrl ||\n      recipe.preview ||\n      recipe.thumb ||\n      '';\n    setBgImage(r.pmImage, img);\n  }\n\n  if (r.pmIngredients) {\n    r.pmIngredients.innerHTML = '';\n    (recipe.ingredients || []).forEach(it => {\n      const name = typeof it === 'string' ? it : it?.name || '';\n      const measure = typeof it === 'string' ? '' : it?.measure || '';\n      const row = document.createElement('div');\n      row.className = 'ing-row';\n      row.innerHTML = `<span class=\"ing-name\">${name}</span><span class=\"ing-measure\">${measure}</span>`;\n      r.pmIngredients.appendChild(row);\n    });\n  }\n\n  if (r.pmTags) {\n    r.pmTags.innerHTML = '';\n    (recipe.tags || []).forEach(tag => {\n      const span = document.createElement('span');\n      span.className = 'tag-chip';\n      span.textContent = `#${tag}`;\n      r.pmTags.appendChild(span);\n    });\n  }\n\n  if (r.pmDesc) r.pmDesc.textContent = recipe.description || '';\n  if (r.favBtn && id)\n    r.favBtn.textContent = isFavorite(id)\n      ? 'Remove to favorite'\n      : 'Add to favorite';\n}\n\nfunction syncFavBtnText() {\n  const r = refs();\n  const id = r.content?.dataset?.recipeId || window.__currentRecipeId || '';\n  if (!r.favBtn || !id) return;\n  r.favBtn.textContent = isFavorite(id)\n    ? 'Remove to favorite'\n    : 'Add to favorite';\n}\n\n/* = Global: openPopup = */\nwindow.openPopup = async function openPopup(recipeOrId) {\n  const r = refs();\n  if (!r.overlay) return;\n  document.documentElement.style.overflow = 'hidden';\n\n  currentRecipe =\n    typeof recipeOrId === 'object' && recipeOrId\n      ? recipeOrId\n      : { _id: String(recipeOrId || '') };\n  renderDetails(currentRecipe);\n  show(r.overlay);\n  syncFavBtnText();\n\n  const id = getIdSafe(currentRecipe);\n  if (!id) return;\n  try {\n    const res = await fetch(`${API_ROOT}/recipes/${encodeURIComponent(id)}`);\n    if (res.ok) {\n      const fresh = await res.json();\n      currentRecipe = { ...currentRecipe, ...fresh };\n      renderDetails(currentRecipe);\n      syncFavBtnText();\n    }\n  } catch {}\n};\n\n/* = Close = */\ndocument.addEventListener('click', e => {\n  const r = refs();\n  if (e.target.closest('.popup-x') || (r.overlay && e.target === r.overlay)) {\n    hide(r.overlay);\n    document.documentElement.style.overflow = '';\n    // src='' yerine about:blank\n    if (r.pmIframe) r.pmIframe.src = 'about:blank';\n  }\n});\nwindow.addEventListener('keydown', e => {\n  if (e.key !== 'Escape') return;\n  const r = refs();\n  if (r.ratingOverlay && !r.ratingOverlay.classList.contains('hidden')) {\n    hide(r.ratingOverlay);\n    return;\n  }\n  hide(r.overlay);\n  document.documentElement.style.overflow = '';\n  // src='' yerine about:blank\n  if (r.pmIframe) r.pmIframe.src = 'about:blank';\n});\n\n/* = Fav buton = */\ndocument.addEventListener('click', e => {\n  const r = refs();\n  if (!e.target.closest('#pm-fav-btn')) return;\n  const id = r.content?.dataset?.recipeId || window.__currentRecipeId || '';\n  if (!id) return;\n  const on = toggleFavoriteById(id, currentRecipe);\n  r.favBtn &&\n    (r.favBtn.textContent = on ? 'Remove to favorite' : 'Add to favorite');\n});\n\n/* ============ ⭐ Rating overlay ============ */\nfunction clearRatingStars(starsRoot) {\n  if (!starsRoot) return;\n  qsa('svg path', starsRoot).forEach(p => p.setAttribute('fill', '#dcdcdc'));\n}\nfunction paintRatingStars(starsRoot, val) {\n  if (!starsRoot) return;\n  clearRatingStars(starsRoot);\n  const full = Math.floor(val);\n  const half = val % 1 >= 0.5;\n  qsa('.star-container', starsRoot).forEach((c, idx) => {\n    const num = idx + 1;\n    const path = qs('path', c);\n    if (!path) return;\n    if (num <= full) path.setAttribute('fill', '#eea10b');\n    else if (num === full + 1 && half)\n      path.setAttribute('fill', `url(#halfGradient-${num})`);\n  });\n}\nfunction validateRatingForm(r) {\n  const email = r.ratingEmail?.value.trim() || '';\n  const okEmail = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email);\n  const ok = currentRating > 0 && okEmail && !ratingSubmitting;\n  if (r.ratingSend) r.ratingSend.disabled = !ok;\n  if (r.ratingHint)\n    r.ratingHint.textContent = ok ? '' : 'Enter valid email and select rating.';\n}\n\n// Tema değişince boş yıldızları yeniden boya\nconst __themeObserver = new MutationObserver(() => {\n  const r = refs();\n  if (r?.pmStars) enforceEmptyStarColor(r.pmStars);\n});\n__themeObserver.observe(document.documentElement, {\n  attributes: true,\n  attributeFilter: ['data-theme'],\n});\n\n/* === A11y fix: rating-stars için role/label === */\nfunction fixRatingStarsA11y() {\n  const titleEl =\n    qs('#rating-title') || qs('.rating-title') || qs('h3.rating-title');\n  const starsEl = qs('#rating-stars');\n\n  if (!starsEl) return;\n\n  // aria-label misuse'u kaldır\n  starsEl.removeAttribute('aria-label');\n\n  // group rolü ve başlığa referans\n  starsEl.setAttribute('role', 'group');\n\n  if (titleEl) {\n    // id garanti altına al\n    if (!titleEl.id) titleEl.id = 'rating-title';\n    starsEl.setAttribute('aria-labelledby', titleEl.id);\n  } else {\n    // yedek: anlamlı kısa bir label ver\n    starsEl.setAttribute('aria-label', 'Rating stars');\n  }\n}\n\n// Aç/kapat eventleri ve DOM hazır olunca A11y düzeltmesini uygula\ndocument.addEventListener('DOMContentLoaded', () => {\n  fixRatingStarsA11y();\n});\n\ndocument.addEventListener('click', e => {\n  const r = refs();\n  if (e.target.closest('#pm-rate-btn')) {\n    const idNow =\n      r.content?.dataset?.recipeId || window.__currentRecipeId || '';\n    if (idNow && r.ratingOverlay)\n      r.ratingOverlay.dataset.recipeId = String(idNow);\n\n    currentRating = 0;\n    ratingSubmitting = false;\n    r.ratingValueEl && (r.ratingValueEl.textContent = '0.00');\n    r.ratingEmail && (r.ratingEmail.value = '');\n    r.ratingHint && (r.ratingHint.textContent = '');\n    r.ratingSend && (r.ratingSend.disabled = true);\n    clearRatingStars(r.ratingStars);\n    show(r.ratingOverlay);\n\n    // emniyet: her açılışta a11y düzeltmesi yerinde olsun\n    fixRatingStarsA11y();\n    return;\n  }\n  if (\n    e.target.closest('#rating-close') ||\n    (r.ratingOverlay && e.target === r.ratingOverlay)\n  ) {\n    hide(r.ratingOverlay);\n  }\n});\n\ndocument.addEventListener('input', e => {\n  const r = refs();\n  if (e.target === r.ratingEmail) validateRatingForm(r);\n});\n\ndocument.addEventListener('click', e => {\n  const r = refs();\n  const halfBtn = e.target.closest('.half-btn');\n  if (!halfBtn || !r.ratingStars?.contains(halfBtn)) return;\n  const val = parseFloat(halfBtn.dataset.val || halfBtn.dataset.value);\n  if (!val) return;\n  currentRating = val;\n  r.ratingValueEl && (r.ratingValueEl.textContent = val.toFixed(2));\n  paintRatingStars(r.ratingStars, val);\n  validateRatingForm(r);\n});\n\ndocument.addEventListener('click', async e => {\n  const r = refs();\n  if (!e.target.closest('#rating-send')) return;\n  if (ratingSubmitting) return;\n\n  const id =\n    r.ratingOverlay?.dataset?.recipeId ||\n    r.content?.dataset?.recipeId ||\n    window.__currentRecipeId ||\n    '';\n  if (!id) {\n    if (r.ratingHint) {\n      r.ratingHint.textContent = 'Technical error: recipe id missing.';\n      r.ratingHint.classList.remove('ok');\n    }\n    return;\n  }\n\n  const payload = {\n    rate: Number(currentRating),\n    email: (r.ratingEmail?.value || '').trim(),\n  };\n\n  try {\n    ratingSubmitting = true;\n    validateRatingForm(r);\n    r.ratingHint && (r.ratingHint.textContent = '');\n\n    const url = `${API_ROOT}/recipes/${encodeURIComponent(id)}/rating`;\n    const res = await fetch(url, {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(payload),\n    });\n\n    if (!res.ok) {\n      let msg = 'Failed to send rating';\n      try {\n        const data = await res.json();\n        if (data?.message) msg = data.message;\n      } catch {}\n      throw new Error(`${msg} (HTTP ${res.status})`);\n    }\n\n    if (r.ratingHint) {\n      r.ratingHint.textContent = 'Thanks for rating!';\n      r.ratingHint.classList.add('ok');\n    }\n\n    try {\n      const fresh = await fetch(\n        `${API_ROOT}/recipes/${encodeURIComponent(id)}`\n      ).then(x => x.json());\n      r.pmRatingVal &&\n        (r.pmRatingVal.textContent = format2Trunc(fresh?.rating));\n      renderStaticStars(r.pmStars, fresh?.rating ?? 0);\n    } catch {}\n\n    setTimeout(() => hide(r.ratingOverlay), 900);\n  } catch (err) {\n    if (r.ratingHint) {\n      r.ratingHint.textContent = err?.message || 'Error sending rating.';\n      r.ratingHint.classList.remove('ok');\n    }\n  } finally {\n    ratingSubmitting = false;\n    validateRatingForm(r);\n  }\n});\n"],"names":["hamburgerButton","mobileMenu","navMenu","closeButton","toggleLabel","toggleInput","checkTheme","currentTheme","API_ROOT","qs","s","p","qsa","show","el","hide","format2Trunc","v","n","setBgImage","url","safe","SPRITE_PATH","svgIcon","name","className","starFilledHTML","starEmptyHTML","enforceEmptyStarColor","root","docEl","color","svg","u","renderStaticStars","container","val","full","getFavorites","setFavorites","arr","getIdSafe","o","findIndexById","list","id","r","makeFavoritePayload","src","_a","isFavorite","emitFavoritesSync","on","ev","emitFavoritesUpdated","toggleFavoriteById","recipeObjForAdd","idx","nowOn","currentRecipe","currentRating","ratingSubmitting","refs","renderDetails","recipe","yt","_b","vid","_c","_d","_e","img","it","measure","row","tag","span","syncFavBtnText","recipeOrId","res","fresh","e","clearRatingStars","starsRoot","paintRatingStars","half","c","num","path","validateRatingForm","email","okEmail","ok","__themeObserver","fixRatingStarsA11y","titleEl","starsEl","idNow","halfBtn","payload","msg","data","x","err"],"mappings":"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"}