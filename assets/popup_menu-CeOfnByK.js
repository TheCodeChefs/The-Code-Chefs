(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();const L=document.querySelector(".hamburger-button"),h=document.querySelector(".mobile-menu"),C=document.querySelector(".nav-menu"),N=document.querySelector(".close-button"),H=document.querySelector(".toggle-label"),w=document.querySelector(".toggle");L.addEventListener("click",()=>{h.classList.add("show"),L.classList.add(".show"),C.classList.add("nav-show"),H.classList.add("toggle-label-show"),w.classList.add("toggle-label-show")});N.addEventListener("click",()=>{h.classList.remove("show"),L.classList.remove(".show"),C.classList.remove("nav-show"),H.classList.remove("toggle-label-show"),w.classList.remove("toggle-label-show")});w.addEventListener("change",()=>{w.checked?(document.body.setAttribute("data-theme","dark"),h.classList.add("mobile-menu-color")):(document.body.setAttribute("data-theme","light"),h.classList.remove("mobile-menu-color"))});const S="https://tasty-treats-backend.p.goit.global/api",s=(t,e=document)=>e.querySelector(t),$=(t,e=document)=>[...e.querySelectorAll(t)],O=t=>t&&t.classList.remove("hidden"),y=t=>t&&t.classList.add("hidden");function R(t){const e=Number.parseFloat(String(t??"").replace(",","."));return Number.isFinite(e)?(Math.trunc(e*100)/100).toFixed(2):"0.00"}function V(t,e){if(!t)return;if(!e){t.style.backgroundImage="";return}const n=String(e).trim().replace(/"/g,"%22").replace(/\)/g,"%29").replace(/\(/g,"%28").replace(/\\+/g,"");t.style.backgroundImage=`url("${n}")`}const P="./img/icons.svg",_=(t,e="")=>`<svg class="icon ${e}" aria-hidden="true" focusable="false">
     <use href="${P}#icon-${t}"></use>
   </svg>`;function k(){try{const t=JSON.parse(localStorage.getItem("favorites"));return Array.isArray(t)?t:[]}catch{return[]}}function q(t){localStorage.setItem("favorites",JSON.stringify(t||[]))}const I=t=>(t==null?void 0:t._id)||(t==null?void 0:t.id)||(t==null?void 0:t.recipeId)||"",F=(t,e)=>(t||[]).findIndex(n=>String(I(n))===String(e));function U(t){var n;const e=I(t);return{...t,_id:e,title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",rating:Number(t==null?void 0:t.rating)||0,preview:(t==null?void 0:t.preview)||(t==null?void 0:t.thumb)||(t==null?void 0:t.image_url)||(t==null?void 0:t.imageUrl)||"",category:typeof(t==null?void 0:t.category)=="string"?{name:t.category}:(n=t==null?void 0:t.category)!=null&&n.name?t.category:(t==null?void 0:t.category)||{}}}function A(t){return F(k(),t)!==-1}function j(t,e){const n=new CustomEvent("favorites:sync",{detail:{id:String(t),on:!!e}});window.dispatchEvent(n),document.dispatchEvent(n)}function D(){const t=new Event("favorites:updated");window.dispatchEvent(t),document.dispatchEvent(t)}function J(t,e){const n=k(),i=F(n,t);let a=!1;return i!==-1?(n.splice(i,1),a=!1):(n.unshift(U(e||{_id:t})),a=!0),q(n),j(t,a),D(),a}let f=null,E=0,v=!1;window.__currentRecipeId="";function m(){return{overlay:s("#popup-overlay"),content:s("#popup-content"),pmImage:s("#pm-image"),pmVideo:s("#pm-video"),pmIframe:s("#pm-iframe"),pmTitle:s("#pm-title"),pmRatingVal:s("#pm-rating-val"),pmStars:s("#pm-stars"),pmTime:s("#pm-time"),pmIngredients:s("#pm-ingredients"),pmTags:s("#pm-tags"),pmDesc:s("#pm-desc"),favBtn:s("#pm-fav-btn"),rateBtn:s("#pm-rate-btn"),ratingOverlay:s("#rating-overlay"),ratingStars:s("#rating-stars"),ratingValueEl:s("#rating-value"),ratingEmail:s("#rating-email"),ratingSend:s("#rating-send"),ratingHint:s("#rating-hint")}}const z=`<span class="star filled">${_("Star")}</span>`,G=`<span class="star empty">${_("Star-empty")}</span>`;function B(t,e){if(!t)return;const n=Number(e)||0,i=Math.min(5,Math.max(0,Math.floor(n)));t.innerHTML=`<span class="star-row">
    ${z.repeat(i)}${G.repeat(5-i)}
  </span>`}function T(t){var a,r,l,g,p;const e=m();if(!e.content)return;const n=String(I(t));n&&(e.content.dataset.recipeId=n,e.ratingOverlay&&(e.ratingOverlay.dataset.recipeId=n),window.__currentRecipeId=n),e.pmTitle&&(e.pmTitle.textContent=t.title||"Untitled"),e.pmRatingVal&&(e.pmRatingVal.textContent=R(t.rating)),B(e.pmStars,t.rating||0),e.pmTime&&(e.pmTime.textContent=t.time?`${t.time} min`:"");const i=t.youtube||t.youtubeUrl||"";if(i){(a=e.pmVideo)==null||a.classList.remove("hidden"),(r=e.pmImage)==null||r.classList.add("hidden");const o=((l=i.match(/(?:v=|\/)([0-9A-Za-z_-]{11})(?:\b|&|$)/))==null?void 0:l[1])||i;e.pmIframe&&(e.pmIframe.src=`https://www.youtube.com/embed/${o}?rel=0&modestbranding=1&playsinline=1`)}else{(g=e.pmVideo)==null||g.classList.add("hidden"),(p=e.pmImage)==null||p.classList.remove("hidden");const o=t.image_url||t.imageUrl||t.preview||t.thumb||"";V(e.pmImage,o)}e.pmIngredients&&(e.pmIngredients.innerHTML="",(t.ingredients||[]).forEach(o=>{const u=typeof o=="string"?o:(o==null?void 0:o.name)||"",c=typeof o=="string"?"":(o==null?void 0:o.measure)||"",d=document.createElement("div");d.className="ing-row",d.innerHTML=`<span class="ing-name">${u}</span><span class="ing-measure">${c}</span>`,e.pmIngredients.appendChild(d)})),e.pmTags&&(e.pmTags.innerHTML="",(t.tags||[]).forEach(o=>{const u=document.createElement("span");u.className="tag-chip",u.textContent=`#${o}`,e.pmTags.appendChild(u)})),e.pmDesc&&(e.pmDesc.textContent=t.description||""),e.favBtn&&n&&(e.favBtn.textContent=A(n)?"Remove to favorite":"Add to favorite")}function x(){var n,i;const t=m(),e=((i=(n=t.content)==null?void 0:n.dataset)==null?void 0:i.recipeId)||window.__currentRecipeId||"";!t.favBtn||!e||(t.favBtn.textContent=A(e)?"Remove to favorite":"Add to favorite")}window.openPopup=async function(e){const n=m();if(!n.overlay)return;document.documentElement.style.overflow="hidden",f=typeof e=="object"&&e?e:{_id:String(e||"")},T(f),O(n.overlay),x();const i=I(f);if(i)try{const a=await fetch(`${S}/recipes/${encodeURIComponent(i)}`);if(a.ok){const r=await a.json();f={...f,...r},T(f),x()}}catch{}};document.addEventListener("click",t=>{const e=m();(t.target.closest(".popup-x")||e.overlay&&t.target===e.overlay)&&(y(e.overlay),document.documentElement.style.overflow="",e.pmIframe&&(e.pmIframe.src=""))});window.addEventListener("keydown",t=>{if(t.key!=="Escape")return;const e=m();if(e.ratingOverlay&&!e.ratingOverlay.classList.contains("hidden")){y(e.ratingOverlay);return}y(e.overlay),document.documentElement.style.overflow="",e.pmIframe&&(e.pmIframe.src="")});document.addEventListener("click",t=>{var a,r;const e=m();if(!t.target.closest("#pm-fav-btn"))return;const n=((r=(a=e.content)==null?void 0:a.dataset)==null?void 0:r.recipeId)||window.__currentRecipeId||"";if(!n)return;const i=J(n,f);e.favBtn&&(e.favBtn.textContent=i?"Remove to favorite":"Add to favorite")});function M(t){t&&$("svg path",t).forEach(e=>e.setAttribute("fill","#dcdcdc"))}function K(t,e){if(!t)return;M(t);const n=Math.floor(e),i=e%1>=.5;$(".star-container",t).forEach((a,r)=>{const l=r+1,g=s("path",a);g&&(l<=n?g.setAttribute("fill","#eea10b"):l===n+1&&i&&g.setAttribute("fill",`url(#halfGradient-${l})`))})}function b(t){var a;const e=((a=t.ratingEmail)==null?void 0:a.value.trim())||"",n=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),i=E>0&&n&&!v;t.ratingSend&&(t.ratingSend.disabled=!i),t.ratingHint&&(t.ratingHint.textContent=i?"":"Enter valid email and select rating.")}document.addEventListener("click",t=>{var n,i;const e=m();if(t.target.closest("#pm-rate-btn")){const a=((i=(n=e.content)==null?void 0:n.dataset)==null?void 0:i.recipeId)||window.__currentRecipeId||"";a&&e.ratingOverlay&&(e.ratingOverlay.dataset.recipeId=String(a)),E=0,v=!1,e.ratingValueEl&&(e.ratingValueEl.textContent="0.00"),e.ratingEmail&&(e.ratingEmail.value=""),e.ratingHint&&(e.ratingHint.textContent=""),e.ratingSend&&(e.ratingSend.disabled=!0),M(e.ratingStars),O(e.ratingOverlay);return}(t.target.closest("#rating-close")||e.ratingOverlay&&t.target===e.ratingOverlay)&&y(e.ratingOverlay)});document.addEventListener("input",t=>{const e=m();t.target===e.ratingEmail&&b(e)});document.addEventListener("click",t=>{var a;const e=m(),n=t.target.closest(".half-btn");if(!n||!((a=e.ratingStars)!=null&&a.contains(n)))return;const i=parseFloat(n.dataset.val||n.dataset.value);i&&(E=i,e.ratingValueEl&&(e.ratingValueEl.textContent=i.toFixed(2)),K(e.ratingStars,i),b(e))});document.addEventListener("click",async t=>{var a,r,l,g,p;const e=m();if(!t.target.closest("#rating-send")||v)return;const n=((r=(a=e.ratingOverlay)==null?void 0:a.dataset)==null?void 0:r.recipeId)||((g=(l=e.content)==null?void 0:l.dataset)==null?void 0:g.recipeId)||window.__currentRecipeId||"";if(!n){e.ratingHint&&(e.ratingHint.textContent="Technical error: recipe id missing.",e.ratingHint.classList.remove("ok"));return}const i={rate:Number(E),email:(((p=e.ratingEmail)==null?void 0:p.value)||"").trim()};try{v=!0,b(e),e.ratingHint&&(e.ratingHint.textContent="");const o=`${S}/recipes/${encodeURIComponent(n)}/rating`,u=await fetch(o,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!u.ok){let c="Failed to send rating";try{const d=await u.json();d!=null&&d.message&&(c=d.message)}catch{}throw new Error(`${c} (HTTP ${u.status})`)}e.ratingHint&&(e.ratingHint.textContent="Thanks for rating!",e.ratingHint.classList.add("ok"));try{const c=await fetch(`${S}/recipes/${encodeURIComponent(n)}`).then(d=>d.json());e.pmRatingVal&&(e.pmRatingVal.textContent=R(c==null?void 0:c.rating)),B(e.pmStars,(c==null?void 0:c.rating)??0)}catch{}setTimeout(()=>y(e.ratingOverlay),900)}catch(o){e.ratingHint&&(e.ratingHint.textContent=(o==null?void 0:o.message)||"Error sending rating.",e.ratingHint.classList.remove("ok"))}finally{v=!1,b(e)}});
//# sourceMappingURL=popup_menu-CeOfnByK.js.map
